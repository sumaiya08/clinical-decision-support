#How many unique hospitals? how many ICUs? 

Select COUNT (DISTINCT hospitalid)
from `physionet-data.eicu_crd.hospital`;

Select COUNT (DISTINCT wardid )
from `physionet-data.eicu_crd.patient` 

#How many procedures have ICD9/10 codes available?
select count (distinct diagnosisid)
from `physionet-data.eicu_crd.diagnosis` 
where icd9code is not null

##How many procedures have ICD9/10 codes available?
select diagnosisstring,icd9code,count(*)
from `physionet-data.eicu_crd.diagnosis` 
where icd9code is not null
group by diagnosisstring, icd9code##

#What are the top 10 diseases that patients suffer from? 
select icd9code, count(icd9code), diagnosisstring
from `physionet-data.eicu_crd.diagnosis` 
group by icd9code, diagnosisstring 
order by count(icd9code) desc
limit 10;  # NOT SURE HOW TO TREAT MISSING VALUES

select apacheadmissiondx, count(apacheadmissiondx)
from `physionet-data.eicu_crd.patient` 
group by apacheadmissiondx 
order by count(apacheadmissiondx) desc
limit 10;

#Identify all the patients with heart disease 
	* Can be patients admitted on drugs that treat heart disease (can find just a subset)
select gender, age, ethnicity,apacheadmissiondx,admissionheight,drugname
from `physionet-data.eicu_crd.admissiondrug` a
join `physionet-data.eicu_crd.patient` b ON (
a.patientunitstayid =b.patientunitstayid
)
where drugname like '%CLOPIDOGREL%' # can also look for drug WARFARIN

#Identify all the patients that were admitted and on diabetes drugs (what are these?)
	* Find the unique drugs and figure out which are diabetes usually
 
select gender,age,ethnicity,apacheadmissiondx,admissionheight,drugname
from `physionet-data.eicu_crd.admissiondrug` a
join `physionet-data.eicu_crd.patient` b ON (
a.patientunitstayid =b.patientunitstayid
)
where drugname like '%GLUCAGON%'    #can also look for drug HUMULIN

#What types of visits do patients come to the ICU for? (ie unique procedures) top 5 identify all the patients with 3 types of heart procedures 
select treatmentstring, count (treatmentstring)
from `physionet-data.eicu_crd.treatment` 
group by treatmentstring
order by count(treatmentstring) desc
limit 5;
select gender,age,ethnicity,apacheadmissiondx,treatmentstring
from `physionet-data.eicu_crd.treatment`  a
join `physionet-data.eicu_crd.patient` b ON (
a.patientunitstayid =b.patientunitstayid
)
where a.treatmentstring  like '%cardio%'
#What is the average length of stay for most patients in the ICU? 
	* Can you check the above for patients that are diabetic + patients that suffer from heart disease?
#What is the average length of stay for most patients in the ICU? 
select patienthealthsystemstayid, TIME_DIFF(unitdischargetime24,unitadmittime24, second) as lengthofstay
from `physionet-data.eicu_crd.patient` 
group by patienthealthsystemstayid , lengthofstay
limit 10;

select patienthealthsystemstayid, SUM(TIME_DIFF(hospitaldischargetime24,hospitaladmittime24, minute)) AS lengthofstay, uniquepid
from `physionet-data.eicu_crd.patient` 
group by patienthealthsystemstayid, uniquepid
ORDER BY uniquepid
limit 10;
#How many patients with diabetes and how many patients with heart disease die before they are released from their stay? 
#	* Possible to plot the progression?
select gender, age, ethnicity,apacheadmissiondx,hospitaldischargestatus
from `physionet-data.eicu_crd.patient` 
where apacheadmissiondx like '%Cardi%' and hospitaldischargestatus like '%Expire%';

select gender, age, ethnicity,apacheadmissiondx,hospitaldischargestatus
from `physionet-data.eicu_crd.patient` 
where apacheadmissiondx like '%Diab%' and hospitaldischargestatus like '%Expire%'
